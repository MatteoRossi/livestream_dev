import { initializeApp } from "firebase/app";
import {
  getFirestore,
  doc,
  onSnapshot,
  updateDoc,
  increment,
  collection,
  query,
  orderBy,
} from "firebase/firestore";
import html2canvas from "html2canvas";

const firebaseConfig = {
  apiKey: "AIzaSyAnA_2p1ef6MlnQ9BB2zE446DNGGy7g0ac",
  authDomain: "forum-8423f.firebaseapp.com",
  projectId: "forum-8423f",
  storageBucket: "forum-8423f.appspot.com",
  messagingSenderId: "834054366177",
  appId: "1:834054366177:web:45b07b4c8cc580cec968a0",
};

const app = initializeApp(firebaseConfig);

const db = getFirestore();



/* QUERY VARIABLE */

const livestreamID = "mll2hccPnNBua9PWcE0x"
//check if url containst /fr/

const lang = "en";

const url = window.location.href;
if (url.includes("/fr/")) {
  lang = "fr";
}



let lastReactionsCount = { like: 0, love: 0, cheer: 0 };
let userTriggeredUpdate = false;
let isFirstLoad = true;
let isLive = false;

/* QUERIES */

const qSettings = query(doc(db, "livestreams", livestreamID));

const settings = onSnapshot(qSettings, (doc) => {
  if (doc.data().live) {
    isLive = true;
    document.getElementById("video_component").innerHTML = `
      <iframe class='iframe' src="${doc.data().stream}"
      title="YouTube video player" frameborder="0"
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
      allowfullscreen>
      </iframe>
    `;
    document.querySelectorAll(".reactions_count").forEach((count) => {
      count.querySelector(".count").style.display = "block";
      count.querySelector(".placeholder").style.display = "none";
    });
  } else {
    isLive = false;
    document.getElementById("video_component").innerHTML = `
      <img class='iframe' src= "https://firebasestorage.googleapis.com/v0/b/forum-8423f.appspot.com/o/livestream%2Fposter.jpg?alt=media&token=052dca3e-e347-47bb-90a2-d26588ac1adf" />
    `;

    document.querySelectorAll(".reactions_count").forEach((count) => {
      count.querySelector(".count").style.display = "none";
      count.querySelector(".placeholder").style.display = "block";
    });
  }
});

const reactions = onSnapshot(
  doc(db, "livestreams/" + livestreamID + "/reactions", "reactionsCounts"),
  (doc) => {
    const data = doc.data();

    Object.keys(data).forEach((key) => {
      document.querySelector(
        `#reactions_${key}_count`
      ).innerHTML = `${data[key]}`;
      if (
        data[key] > lastReactionsCount[key] &&
        !userTriggeredUpdate &&
        !isFirstLoad
      ) {
        createAndAnimateEmoji(key);
        triggerContentChangedEvent(`reactions_${key}_count`);
      }
      //also triggercontentchanged event when user triggered update
      if (data[key] > lastReactionsCount[key] && userTriggeredUpdate) {
        triggerContentChangedEvent(`reactions_${key}_count`);
      }
      lastReactionsCount[key] = data[key];
    });

    isFirstLoad = false;

    // Reset the userTriggeredUpdate flag after handling the update
    if (userTriggeredUpdate) {
      userTriggeredUpdate = false;
    }
  }
);

/* CONTENT HANLDER */

const t = {
  "you": {
    "en": "You",
    "fr": "Vous"
  },
  "reaction_text": {
    "en": "Click to react to the speech <b>LIVE</b>!",
    "fr": "Réagissez au discours <b>EN DIRECT</b>!",
  },
  "bingo": {
    "header":{
      "en": "<span style='color:#d71920'>BUDGET</span> BINGO",
      "fr": "BINGO DU <span style='color:#d71920'>BUDGET</span>",
    },
    "link_text": {
      "en": "Click here!",
      "fr": "Cliquez ici!",
    },
    "link": {
      "en": "https://www.liberal.ca",
      "fr": "https://www.liberal.ca/fr",
    },
    "win": {
      "en": "YOU got a BINGO!",
      "fr": "VOUS avez obtenu un BINGO!",
    },
    "share_button": {
      "en": "Share your <b>#BudgetBingo</b> sheet on social!",
      "fr": "Partagez votre <b>#BingoduBudget</b> sur les reseaux sociaux!",
    },
    "s1" : {
      "en": "Conservatives boo progress for Canadians",
      "fr": "Conservateurs hue les progrès pour les Canadiens",
    },
    "s2" : {
      "en": "$10-a-day child care",
      "fr": "Garderies à 10 $ par jour"
    },
    "s3" : {
      "en": "Pierre Poilievre misleads Canadians about fixing the budget",
      "fr": "Pierre Poilievre trompe les Canadiens sur le redressement du budget"
    },
    "s4" : {
     "en": "Liberal Pharmacare mention",
     "fr": "Mention de l'assurance-médicaments libérale"
    },
    "s5" : {
      "en": "Add your name to support our progress",
      "fr": "Ajoutez votre nom pour soutenir nos progrès"
    },
    "s6" : {
      "en": "All provinces/territories get a mention",
      "fr": "Toutes les provinces/territoires obtiennent une mention"
    },
    "s7" : {
      "en": "Conservatives don't clap at children getting the dental care they need",
      "fr": "Les conservateurs n'applaudissent pas les enfants qui reçoivent les soins dentaires dont ils ont besoin"
    },
    "s8" : {
      "en": "Freeland says: 'You shouldn't have to choose between X and Y'",
      "fr": "Freeland dit: « Vous ne devez pas avoir besoin de choisir entre X et Y »"
    },
    "s9" : {
      "en": "Speaker of the House says: 'Rappels au Règlement'",
      "fr": "Le président de la Chambre dit : « rappels au Règlement »"
      
    }
  },
}

const svg = `<svg xmlns="http://www.w3.org/2000/svg" id="Layer_1" data-name="Layer 1" viewBox="0 0 400 400">
<defs>
  <style>
    .cls-1 {
      fill: none;
    }

    .cls-1, .cls-2 {
      stroke-width: 0px;
    }

    .cls-2 {
      fill: #d72027;
    }
  </style>
</defs>
<path class="cls-1" d="M45.23,319.4c.25.32.49.65.74.98l.34-.29c-.25-.33-.49-.65-.74-.97l-.34.28Z"/>
<path class="cls-1" d="M59.68,68.61s.07-.07.1-.1h-.12s.01.07.02.1Z"/>
<path class="cls-1" d="M29.01,289.98c1.7,2.48,1.37.31,0,0h0Z"/>
<path class="cls-1" d="M61.73,67.94l.34.29c.28-.3.56-.59.84-.89l-.34-.29c-.28.3-.56.59-.84.89Z"/>
<path class="cls-1" d="M88.85,46.13c-2.16,2.09-.07,1.4,0,0h0Z"/>
<path class="cls-1" d="M290.28,374.93c.1-.71,2.08-1.69,3.18-2.55-.83.34-1.67.7-2.55,1.1l.1-.44-.16-.05c-.31.14-.61.29-.93.44-.52.23-1.05.47-1.58.72-1.92.91-3.85,1.89-5.41,2.65l.03.06c2.45-.86,5.27-2.09,6.2-1.42l.38.07c.54-.28,1.1-.53,1.61-.89l-.44.16c-.22.08-.44.15-.44.15Z"/>
<path class="cls-1" d="M386.89,146.46c-.87-.28-1.66-3.62-2.52-4.3.08.82.28,1.78.55,2.81.13.52.28,1.05.45,1.59.14.55.29,1.11.45,1.67.63,2.25,1.35,4.52,1.85,6.25-.41-2.66-1.31-5.99-.45-6.85l.13-.37c-.19-.58-.34-1.18-.61-1.73,0,0,.04.23.09.46.04.23.07.46.07.46Z"/>
<path class="cls-1" d="M22.62,121.84c-.34,1.12-.43,2.37-.05,2.69.14-.82.51-1.51.86-2.21.18-.35.34-.71.5-1.09.16-.38.28-.78.34-1.22-.64-.23-1.33.71-1.65,1.84Z"/>
<path class="cls-1" d="M16.93,270.8c-.48.01-.99-1.39-1.47-1.39.82,1.43.88,3.58,1.33,3.46-.43-1.2.55-.87.15-2.08Z"/>
<path class="cls-1" d="M103.67,31.22c1.11-.63.95.39,2.07-.2-.09-.47,1.2-1.21,1.12-1.69-1.27,1.05-3.38,1.47-3.19,1.89Z"/>
<path class="cls-1" d="M254.38,12.86c.4.09.81.15,1.26.13.12-.67-.92-1.19-2.09-1.32-1.16-.15-2.4-.02-2.66.4.83,0,1.57.25,2.33.48.38.12.76.22,1.16.31Z"/>
<path class="cls-1" d="M312.87,60.12c-.62-.15-.96-.27-1.75-.7l.1.15c.31.26.62.52.92.79.44.37.87.73,1.3,1.09.91.49,1.86,1,2.34,1.35-.97-.84-1.53-1.74-2.6-2.02l-.31-.66Z"/>
<path class="cls-1" d="M312.01,59.59l.13-.18c-.84-.66-1.82-1.54-2.75-2.34-.93-.8-1.81-1.5-2.5-1.7.54.59,1.17,1.19,1.94,1.83.38.32.8.65,1.26.98.46.34.96.67,1.49,1.06l-.45.17,1.75.7-.86-.53Z"/>
<path class="cls-1" d="M297.08,48.2c.13.09.25.19.37.29.84.67,1.53,1.33,2.04,1.98.16.12.32.24.5.36.69-.03.94-.48.92-1-.57-.39-1.15-.78-1.73-1.16-.69-.16-1.57-.57-2.1-.46Z"/>
<path class="cls-1" d="M213.73,27.23c.44-.63,1.7-1.12.98-1.53-.07,0-.13,0-.2-.01-.37.17-.71.34-.79.35-.19.02-.45,0-.73-.05-.43.37-.44.92-2.1.76-.2.15-.12.28.07.38.93.03,1.85.07,2.77.11Z"/>
<path class="cls-2" d="M259.28,388.17c1.48-.39,2.89-.79,2.82-1.28-.82.17-1.23.03-2.43.47.12.29-.13.55-.39.81Z"/>
<path class="cls-2" d="M73.87,51.4l-.31-.32c-.31.27-.62.55-.94.82l.31.32c.31-.27.62-.55.93-.82Z"/>
<path class="cls-2" d="M90.95,37.9c-2.26,1.51-2.69,2.16-1.47,2.16,1.63-1.05,2.13-1.77,1.47-2.16Z"/>
<path class="cls-2" d="M128.92,18.56c.54-.18,1.14-.37,1.79-.58.64-.22,1.31-.47,2-.74,1.37-.54,2.77-1.15,4.03-1.74.63-.3,1.22-.59,1.74-.86.53-.26,1.01-.48,1.4-.69-.48-.2-1.32-.17-2.33.12-1.02.28-2.25.75-3.54,1.29-1.29.55-2.66,1.17-3.96,1.78-.65.29-1.27.62-1.86.92-.59.3-1.15.58-1.66.83.46.14,1.32,0,2.4-.34Z"/>
<path class="cls-2" d="M264.75,12.75c.58.31,1.33.52,1.58.32-1.16-.38-.57-.85-2.22-1.18-.39.19.05.55.63.86Z"/>
<path class="cls-2" d="M310.83,38.43l-.05-.51.91.27c-.36-.62-2.22-1.9-4.08-2.89-.46-.25-.93-.48-1.37-.67-.44-.19-.87-.33-1.24-.44-.75-.21-1.3-.23-1.46.02.31.47.55.85.96,1.19.2.17.45.33.76.5.31.18.69.35,1.16.54l.81.38-.42.13c1.51.72,2.26.45,4.01,1.49Z"/>
<path class="cls-2" d="M312.35,39.4c.37.44.66.84,1.09,1.32.43.47,1.02.99,2.03,1.61-.01-.74,1.25.35,1.84.48-.14-1.18-1.85-3.26-1.26-3.61-.58-.03-1.23-.2-1.9-.36-.68-.14-1.36-.29-1.96-.33l.08.44.08.45Z"/>
<path class="cls-2" d="M66.32,62.59l1.1-1.49c-.4.49-.69.9-1.1,1.49Z"/>
<path class="cls-2" d="M95.35,35.2c.25-.15.6-.33.94-.52.68-.38,1.37-.76,1.37-.76-.91.49-1.85.89-2.72,1.53,0,0,.17-.1.42-.25Z"/>
<path class="cls-2" d="M306.2,36.82h1.04c-.43-.04-.82-.03-1.04,0Z"/>
<path class="cls-2" d="M290.36,375.07c.2-.11.4-.22.55-.31.15-.09.25-.15.25-.15-.5.36-1.06.61-1.61.89,0,0,.4-.22.81-.43Z"/>
<path class="cls-2" d="M311.12,59.42c.79.43,1.13.55,1.75.7l-1.75-.7Z"/>
<path class="cls-2" d="M66.6,347.71c-1.39-1.39-2.19-1.72-2.44-1,.77.7,1.55,1.4,2.33,2.1.37-.23-.21-.85.11-1.1Z"/>
<path class="cls-2" d="M394.76,179.24c-.14-1.52-.3-2.98-.79-2.99.03.84-.18,1.21.06,2.47.3-.07.52.22.73.52Z"/>
<path class="cls-2" d="M31.33,305.89c.22.35.44.71.65,1.06l.37-.25c-.22-.35-.44-.71-.65-1.06l-.37.25Z"/>
<path class="cls-2" d="M86.1,360.27c-.29-.25-.6-.51-.92-.79-1.29-1.08-2.75-2.22-3.78-2.55-.04.99,1.59,2.62,3.23,3.78.81.59,1.66,1,2.28,1.19.62.19,1.03.13,1.01-.3-.15-.04-.51-.3-1-.69-.24-.19-.52-.41-.82-.65Z"/>
<path class="cls-2" d="M21.24,286.54c1.11,2.48,1.68,3.01,1.88,1.81-.76-1.79-1.39-2.39-1.88-1.81Z"/>
<path class="cls-2" d="M393.81,213.32c-.09,1.11.03,2.22.48,2.16.12-1.42.26-2.84.29-4.28-.45-.1-.68,1.01-.77,2.12Z"/>
<path class="cls-2" d="M188.71,396.26l3.7.14c.68-.9-4.35-1.09-3.7-.14Z"/>
<path class="cls-2" d="M8.26,244.01c-.11-.67-.24-1.37-.39-2.09-.3-1.44-.67-2.93-1.04-4.26-.19-.67-.37-1.3-.55-1.86-.16-.57-.31-1.08-.45-1.49-.27.44-.39,1.27-.27,2.32.11,1.05.36,2.34.68,3.71.32,1.37.71,2.82,1.09,4.2.18.69.4,1.36.6,1.99.2.63.38,1.23.54,1.78.22-.42.22-1.3.07-2.43-.08-.56-.18-1.19-.28-1.86Z"/>
<path class="cls-2" d="M25.55,110.98c.4-.53.74-1.22.58-1.51-.57,1.08-.93.42-1.54,1.99.12.42.55.04.96-.48Z"/>
<path class="cls-2" d="M395.28,199.55c-.56-.37-.87-.12-1.15-2.41.48-2.83-1.02-11.1.16-11.05-.27-.83-.42-1.72-.52-2.64-.13-.92-.19-1.87-.22-2.83-.06-1.91,0-3.84-.17-5.54-.07-.91-.23-1.81-.42-2.7-.19-.9-.38-1.8-.57-2.7-.39-1.8-.75-3.62-.99-5.44-.43-2.76-.26-5.24-.81-8.01-.08-.4-.17-.81-.27-1.22-.12-.4-.24-.8-.37-1.21-.26-.8-.54-1.61-.83-2.39-.58-1.58-1.17-3.1-1.65-4.5l-.13.36-.13.37c-.87.86.04,4.19.45,6.85-.5-1.73-1.23-4.01-1.85-6.25-.16-.56-.31-1.12-.45-1.67-.16-.54-.31-1.08-.45-1.59-.27-1.03-.46-1.99-.55-2.81.87.68,1.66,4.02,2.52,4.3,0,0-.03-.23-.07-.46-.04-.23-.09-.46-.09-.46l.41.19c-.74-2.67-1.44-5.48-2.16-8.36-.8-2.85-1.69-5.75-2.63-8.65-.22-.73-.49-1.44-.78-2.15l-.85-2.12c-.58-1.41-1.18-2.8-1.82-4.18-.61-1.38-1.38-2.68-2.12-3.97-.76-1.28-1.55-2.53-2.38-3.72l-.23.47-.63-.7c-.46.53,1.42,3.3,1.29,4.15-.61-.39-1.87-2.44-2.81-4.49-1.01-2.02-1.73-4.05-1.07-4.5.32-.18.92,1.42,1.27,1.38-.45-1.58-1.3-3.52-2.35-5.53-.5-1.02-1.15-1.99-1.78-2.98-.63-.98-1.29-1.94-1.94-2.85-.25.79.37,2.27.47,3.33-.94-1.07-1.81-2.26-2.66-3.48-.42-.61-.83-1.23-1.25-1.84-.43-.6-.86-1.19-1.29-1.78-1.71-2.33-3.32-4.48-5.08-5.7-.54-1.1.21-1.36-1.11-2.96-.81-1.01-1.74-2.3-2.76-3.69-.5-.7-1.06-1.4-1.63-2.11-.57-.71-1.15-1.42-1.74-2.12-1.18-1.4-2.36-2.76-3.53-3.89-1.2-1.1-2.34-1.99-3.35-2.53-2.13-2.96-6.91-7.8-9.69-9.78-.12-.14-.25-.28-.37-.41,1.23.6,1.75.1,1.59-.95-1.05-1.03-2.47-2.22-3.96-3.54-1.51-1.3-3.06-2.76-4.62-4.04-3.07-2.62-5.6-5.23-5.93-6.77-.98-.69-1.96-1.38-2.94-2.07-1.77-.55.64,1.78-.86,1.3-1.33-.86-2.33-1.72-3.29-2.48-.99-.72-1.93-1.36-3.13-1.82-.44.1-.01,1.35-1.08.63-1.53-.95-2.44-1.78-2.66-2.47,1.32.56,1.59-.34,1.4-1.23l-.51-.32.11-.19c-.29-.09-.78-.34-1.36-.63-.59-.28-1.26-.64-1.9-.98-1.28-.7-2.44-1.38-2.55-1.5-.05-1.45,2.1-.3,2.62-1.07-1.3-.77-2.32-1.6-3.37-2.47-1.04-.89-2.14-1.74-3.58-2.6-1.19-.72-2.47-1.41-3.8-2.09-.66-.34-1.33-.67-2.01-1-.69-.3-1.39-.59-2.09-.89-1.4-.59-2.79-1.17-4.16-1.74-1.36-.58-2.68-1.17-3.97-1.69-2.03-.86-3.26-1.5-4.42-2.05-.58-.27-1.15-.52-1.79-.76-.32-.12-.66-.24-1.03-.35-.37-.1-.78-.2-1.23-.3-4-.87-5.67-1.48-7.13-1.67.56-.09.93-.32.88-.88-.29-.13-.78-.39-1.32-.68-.55-.28-1.14-.58-1.59-.84-.92-.51-1.3-.82.23-.23-1.05-.82-3.51-1.97-6.09-2.88-1.29-.48-2.63-.78-3.83-.99-1.2-.2-2.26-.28-3.02-.16,1.84.83,5.63,1.41,4.47,2.61-1.59-.42-4.41-1.1-6.72-1.89-2.3-.82-4.15-1.56-3.7-2.43-1.7-.7-4.33-1.23-6.6-1.82-1.62.01.3,1.4-.78,1.22-2.59-.43-2.74.47-4.38.56-1.18-.59-4.66-.63-4.15-1.63-2.09.12-3.28-.22-4.25-.84,2.42.04,5.07.41,5.59-.34-2.59-1.03-6.12-.27-9.84-.85-1.37.23.75.6-.65.63-2.82-.41-4.7-.21-6.38-.01-1.69.21-3.19.48-5.26.54.28.5,1.43,1.23-.57,1.33-2.34.15-2.98-.33-5.48-.08.39-.7.41-.44-.06-1.11-1.88.19-3.19.15-4.3.03-1.11-.13-2.02-.25-3.1-.35-2.18.88,3.34.95.79,1.95-1.46-1.49-5.62.83-7.91.42.67-.69.58-1.43-.26-1.99-1.88.16-3.87.33-5.9.51-2.03.18-4.12.31-6.14.66-4.05.63-7.97,1.35-11.01,2.73,1.15.15,2.49.03,3.92-.15,1.43-.15,2.95-.41,4.44-.67s2.95-.53,4.26-.68c1.31-.15,2.48-.1,3.37.1-1.68.06-1.14.6-2.34.76-1.74-.18-3.4.23-5.12.77-.86.28-1.74.57-2.66.87-.92.3-1.88.54-2.89.82-1.64-.26-3.57-.34-6.27.1,1.39-1.19,0-1.32-1.2-2.01-2.12.23-3.41.91-4.48,1.45-1.08.55-1.92,1.04-3.13,1.12-.6,1.05,1.76-.06,1.52.72-1.25-.07-1.03.44-2.95.86-.61-.69-.65-.51-1.16-1.52-1,.31-1.81.7-2.69,1.06-.88.37-1.84.74-3.11,1.11-1.34.74,1.49.38-.19,1.24-1.2.33-2.36.68-3.48,1.05-1.11.39-2.16.84-3.19,1.26-2.05.86-3.97,1.74-5.82,2.56-1.81.89-3.55,1.72-5.28,2.41-1.72.71-3.47,1.21-5.21,1.66.51-.42.94-.83,1.32-1.22.38-.38.7-.76.94-1.12-1.59.98-1.23.02-1.54-.27-2.92,1.56-5.2,2.79-7.2,3.98-.5.3-.98.59-1.45.9-.46.32-.9.65-1.34.98-.88.67-1.72,1.38-2.58,2.17-.5-.55-2.61.34-4.85,1.63-2.2,1.34-4.54,3.03-5.65,3.86l.46.1-.72.6c.47.31,2.4-1.3,2.98-1.14-1.79,1.33-2.85,2.53-3.81,3.42-.95.91-1.83,1.46-3.34,1.45-1.53.86-2.42,1.72-3.15,2.46-.37.37-.69.7-1.04.99-.34.3-.7.55-1.15.74.11.77.06,1.6-1.56,2.94,1.25.24.85.18-.38,1.44.61-2.31-3.11.37-3.32-1.06-.56.45-1.14.9-1.7,1.37-.55.48-1.1.96-1.63,1.42-1.07.91-2.08,1.73-2.94,2.27.9,0,1.21.63-.48,2.2l-.77-.81c-.88,1.06-1.77,1.74-2.82,2.53-1.05.79-2.24,1.7-3.63,3.26-.64,1.67,2.54-1.28,3.05-.47-1.05.82-1.36,1.44-1.8,2.19-.43.73-1,1.56-2.4,2.91-.05,0-.1.01-.15.02-.03-.18.18-.48.14-.66l-.71.59-.04-.45c-.72.6-1.53,1.36-2.34,2.15.02-.04.04-.07.05-.11-1.18-.06-3.52,1.28-3.76.63-.13.56-.41,1.18-.67,1.81-.1.26-.21.52-.3.78-.19-.18-.48-.21-.94.05-2.01,2.26-3.26,3.94-4.31,5.56-.9,1.43-1.59,2.85-2.51,4.56.09-.46.15-.9-.11-1.15-.98,1.15-1.96,2.02-3,2.9-1.05.87-2.08,1.82-3.17,3.1-.91,1.06-1.81,2.2-2.69,3.39-.44.6-.89,1.2-1.32,1.82-.41.63-.82,1.27-1.23,1.91-.24.38-.49.77-.73,1.15-.02-.24-.17-.38-.44-.42-.56.88-1.12,1.76-1.68,2.64.2.23.51-.02.78-.11-.12.18-.23.37-.35.55-.8,1.25-1.6,2.45-2.33,3.63-1.18,1.86-2.02,2.96-2.76,4.02-.37.53-.71,1.04-1.05,1.63-.17.3-.35.61-.52.96-.16.35-.33.74-.5,1.16-1.53,3.8-2.4,5.34-2.84,6.75,0-.56-.16-.97-.72-1.02-.17.26-.51.71-.9,1.19-.36.49-.76,1.02-1.09,1.43-.66.82-1.03,1.15-.19-.27-.98.9-2.53,3.13-3.85,5.53-.69,1.19-1.21,2.46-1.61,3.61-.4,1.15-.65,2.18-.66,2.95,1.12-1.67,2.33-5.31,3.32-3.97-.68,1.5-1.83,4.16-2.98,6.31-1.19,2.13-2.23,3.83-3.01,3.24-.97,1.56-1.94,4.06-2.9,6.2-.26,1.6,1.43-.06,1.08.97-.86,2.48,0,2.78-.18,4.41-.78,1.07-1.4,4.49-2.3,3.82-.23,2.08-.77,3.2-1.54,4.05.44-2.38,1.26-4.93.6-5.57-1.45,2.38-1.29,5.98-2.49,9.56,0,1.39.71-.64.51.74-.87,2.71-.99,4.6-1.08,6.29-.08,1.7-.06,3.22-.35,5.28.54-.19,1.46-1.2,1.21.79-.25,2.34-.82,2.89-1,5.39-.62-.5-.37-.47-1.11-.13-.13,1.89-.39,3.17-.69,4.24-.31,1.07-.58,1.95-.86,3,.5,2.3,1.5-3.14,2.06-.46-1.71,1.19-.12,5.68-.91,7.87-.57-.77-1.31-.81-2.01-.08-.16,1.88-.32,3.87-.49,5.9-.16,2.03-.39,4.11-.38,6.16-.05,4.1,0,8.09.85,11.31.34-1.11.45-2.45.51-3.89.09-1.44.09-2.98.08-4.49,0-1.51-.02-2.99.04-4.31.07-1.32.32-2.47.67-3.31-.22,1.67.4,1.23.36,2.43-.47,1.69-.34,3.39-.1,5.18.13.89.27,1.81.41,2.77.14.95.22,1.94.32,2.99-.53,1.57-.93,3.46-.95,6.2-.94-1.57-1.3-.22-2.18.84-.12,2.13.33,3.51.68,4.66.37,1.15.7,2.07.58,3.28.94.77.23-1.74.96-1.38-.28,1.22.26,1.09.35,3.05-.78.48-.61.56-1.69.89.14,1.04.38,1.9.6,2.83.22.93.42,1.94.57,3.25.51,1.45.62-1.41,1.19.4.12,1.24.27,2.44.45,3.6.2,1.16.46,2.27.71,3.36.51,2.17,1.05,4.21,1.55,6.16.57,1.94,1.1,3.79,1.49,5.61.41,1.82.61,3.62.76,5.41-.32-.57-.66-1.07-.98-1.51-.31-.44-.63-.81-.95-1.11.7,1.73-.19,1.21-.53,1.47,1.05,3.14,1.88,5.6,2.72,7.77.21.54.42,1.07.65,1.58.24.51.49,1,.74,1.49.51.98,1.07,1.93,1.7,2.91-.62.4-.1,2.63.8,5.05.96,2.39,2.23,4.99,2.86,6.22l.18-.43.47.81c.39-.41-.88-2.58-.62-3.13,1.01,1.99,2.01,3.24,2.73,4.33.74,1.09,1.14,2.05.87,3.54.59,1.65,1.29,2.67,1.9,3.52.3.42.58.8.8,1.19.24.39.43.78.54,1.26.78.02,1.58.21,2.64,2.03.45-1.19.32-.81,1.36.62-2.18-.99-.16,3.13-1.6,3.1.35.62.7,1.27,1.07,1.9.38.63.76,1.25,1.13,1.85.72,1.21,1.36,2.34,1.74,3.28.15-.88.82-1.09,2.09.84l-.92.62c.9,1.04,1.42,2.04,2.02,3.21.6,1.17,1.3,2.5,2.61,4.12,1.54.91-.84-2.72.05-3.09.64,1.17,1.19,1.58,1.85,2.14.67.56,1.4,1.28,2.56,2.97-.18.14-.51-.23-.72-.22l.46.8-.45-.04c.74,1.27,1.82,2.81,2.83,4.22.5.7.99,1.38,1.4,1.96.44.57.8,1.05,1.04,1.41-.64.03-1.81-.08-1.36,1.16,1.89,2.36,3.34,3.88,4.76,5.18,1.44,1.28,2.91,2.3,4.73,3.75l-.16.15.85.76.25.76c.53.71.85.95,1.17,1.16.31.21.61.38,1.11.94l-.16.16.74.58.58.73c2.92,1.77,3.38,4.12,4.09,5.62,1.4,1.28,2.11,1.27,3.21,2,.63-.73-.14-2.03.7-2.68.43.15,2.85,1.91,2.73,2.46-.59,1.09-1.88-.43-1.75,1.12,1.74,1.39,2.54,2.39,2.33,3,2.89,1.23,4.93,3.52,7.07,6.08,1.09-.53,1.5.06,3.26.78-3.4-2.22-.81-1.5-.56-2.36-.99-.91-1.9-.71-1.31-1.31.25.19.53.42.83.7.31.27.65.56,1,.88.71.64,1.49,1.36,2.27,2.04,1.57,1.36,3.15,2.56,4.23,2.6.95.9,1.13,1.58,2.68,2.61l.82.42.71.6c1.08.06,3.97,2.38,3.35,2.75,1.96,1.3,1.6-.24,4.02,1.63-1.74-.31-1.7.71-.46,2.06-.2-.98,1.42-.49,3.39.52.98.52,2.08,1.1,3.09,1.72,1.01.62,1.92,1.25,2.55,1.81,1.31.41,2.14.29,3.65.93,2.66,1.37,5.26,2.71,7.8,4.02,1.26.69,2.55,1.26,3.82,1.86,1.27.59,2.53,1.18,3.78,1.76,2.48,1.2,5.02,2.15,7.51,3.09,1.25.47,2.5.92,3.74,1.35,1.25.42,2.52.74,3.78,1.08.8-.36.8-1.3,3.82-.03-.83.06-.96.57-.28,1.08.85.32,1.72.62,2.61.93.9.26,1.82.52,2.76.77,1.87.51,3.82,1,5.82,1.49,1,.27,2.02.45,3.06.66,1.04.2,2.09.41,3.15.62,1.06.21,2.13.43,3.22.65.54.11,1.09.22,1.63.33.55.09,1.1.18,1.66.27l-.25-.45.94-.13c.51-.54-2.88-.24-2.36-.79,3.51.64,7.13.78,9.08,1.27-.94.28-2.59.21-3.15.69,1.05.21,2.09.41,3.13.62l.79.15c.26.04.53.08.8.12.53.07,1.07.15,1.62.22,2.18.29,4.5.55,7.11.71.53-.61-3.62-1.03-1.79-1.27,1.16.07,2.19.04,3.19-.02.44.06.89.11,1.34.15,1.86.18,3.68.25,4.9.22.17.02.35.05.52.07,1.11.11,2.25.13,3.43.01,2.35-.19,4.82-.58,7.41-.65-1,.46.07.28.05.89.35.04.73.08,1.14.1.4,0,.83,0,1.27,0,.88-.02,1.81-.06,2.73-.1,1.83-.07,3.6-.12,4.74.1-.72.08-1.75.08-1.82.34l.95.2-.27.43c.48-.04,1.14-.04,1.89-.04.75-.01,1.57-.07,2.41-.12,1.66-.13,3.33-.37,4.29-.92h-.94s.26-.37.26-.37c-.16-.35,3.94-.91,3.1-.13-.2.02-.41.05-.61.07l.36.3-.9.22c.55.15,1.61.23,2.61.08,1-.14,1.94-.41,2.29-.79l-.94.04.25-.38c.27-.78,1.84-.56,2.41-.22l-1.26.29c.82-.09,1.66-.12,2.23-.51l-.24.38c.95.41,3.76-.54,4.88-.84.36-.81-1.1-.46-1.45-.86.2-.07.39-.13.57-.2.37.02.78.02,1.21-.03.82-.07,1.76-.22,2.88-.47.27-.61-.02-.88,2.18-1.53.02,0,.04,0,.05,0,.59.16,1.38.15,2.32.02,1.27-.17,2.76-.66,4.31-1.16.59-.19,1.18-.39,1.77-.6,1.41-.28,2.41-.37,2.46.04.77-.41,1.62-.7,2.52-.96.88-.28,1.81-.5,2.75-.69,1.87-.38,3.79-.65,5.43-1.09.88-.22,1.74-.53,2.6-.86.85-.34,1.71-.68,2.57-1.01,1.71-.69,3.44-1.35,5.2-1.88,2.65-.89,5.12-1.13,7.76-2.14.38-.15.77-.3,1.15-.47.38-.18.75-.37,1.13-.57.75-.39,1.49-.8,2.22-1.22,1.46-.83,2.86-1.68,4.16-2.38l-.38-.07-.38-.07c-.93-.67-3.75.57-6.2,1.42l-.03-.06c1.56-.76,3.48-1.75,5.41-2.65.53-.25,1.06-.49,1.58-.72.31-.15.62-.3.93-.44l.16.05-.1.44c.88-.4,1.72-.76,2.55-1.1-1.09.86-3.07,1.84-3.18,2.55,0,0,.22-.07.44-.15l.44-.16-.12.44c2.51-1.17,5.16-2.33,7.88-3.53.26-.12.52-.25.78-.37.07.12.27.15.68.06.71-.43,1.42-.87,2.13-1.3l-.15-.05c1.55-.77,3.1-1.56,4.66-2.37.68-.34,1.34-.73,1.99-1.12l1.95-1.19c1.29-.81,2.57-1.63,3.81-2.49,1.26-.83,2.41-1.81,3.56-2.76,1.14-.96,2.23-1.95,3.27-2.97l-.5-.14.59-.74c-.6-.37-3.02,1.95-3.87,1.96.28-.67,2.09-2.25,3.96-3.52,1.82-1.33,3.7-2.38,4.26-1.81.23.29-1.25,1.15-1.15,1.48,1.48-.71,3.26-1.88,5.06-3.24.92-.67,1.77-1.47,2.64-2.25.86-.79,1.7-1.6,2.49-2.39-.82-.12-2.17.75-3.2,1.03.9-1.1,1.92-2.17,2.98-3.2.54-.51,1.07-1.03,1.6-1.54.52-.53,1.03-1.05,1.54-1.57,1.11-1.14,2.16-2.25,3.04-3.34.57-.4,1.25-.97,1.9-1.62.51-.53,1.02-1.1,1.46-1.64.3-.15.64-.42,1.1-.96.86-.96,1.97-2.1,3.17-3.34.61-.61,1.2-1.28,1.8-1.96.6-.68,1.21-1.38,1.8-2.07,1.18-1.4,2.33-2.79,3.24-4.13.88-1.36,1.57-2.64,1.94-3.72,2.75-2.79,7.14-8.97,8.31-11.85,1.21-1.44,2.32-3.07,3.32-4.76.5-.85.97-1.71,1.4-2.58.41-.88.77-1.78,1.1-2.65.26-.68.49-1.35.71-2.01.51-.79,1.03-1.66,1.59-2.85-.22-.11-.49-.18-.67-.32.18-.74.31-1.44.4-2.08.73-1.48,1.63-3.3,2.42-4.89.89-1.87,1.52-3.48,1.11-4.05.47-.43.91-.98,1.36-1.6.45-.62.9-1.31,1.34-2.07.9-1.51,1.78-3.24,2.61-5.06.78-1.84,1.46-3.78,2.08-5.64.31-.93.59-1.85.85-2.73.13-.44.25-.87.37-1.29.09-.43.19-.84.27-1.24-.38-.49-.69.13-1.01.72-.32.59-.68,1.15-1.04.59.62-2.18,1.34-1.27,1.9-3.9-.38-.53,0-2.1-.38-2.63-.18.44-.35,1.15-.56,1.11l-.15.9-.24-.38c-.28,1.11-.62,1.21-.91,2.26-.28-.2.22-1.46.48-2.38l.15-.9.24.38c1.3-3.3,3.85-5.55,3.28-1.66.37-.61.74-1.39,1.1-2.25.31-.87.61-1.82.86-2.77.52-1.9.9-3.79,1.07-5.01-.52-.82-.76.83-1.16,1.01.21-1.14.53-2.34.77-3.5.22-1.17.44-2.3.56-3.27.25-1.95.16-3.26-.88-3.06.39-.98.64-1.95.82-2.92.17-.97.2-1.94.24-2.9.06-1.92,0-3.79.26-5.61.08-.56.18-1.1.31-1.64.12-.54.24-1.08.36-1.62.25-1.08.51-2.17.68-3.33.24-1.69.35-3.37.47-5.07.05-1.71.13-3.44.39-5.24.44-.91.91-1.76,1.26-2.95.16-.6.35-1.28.4-2.1.07-.82.08-1.78.02-2.92ZM16.79,272.88c-.45.11-.51-2.03-1.33-3.46.48,0,.99,1.4,1.47,1.39.4,1.2-.58.87-.15,2.08ZM23.93,121.22c-.15.38-.32.74-.5,1.09-.35.71-.72,1.4-.86,2.21-.38-.32-.29-1.57.05-2.69.32-1.13,1.01-2.06,1.65-1.84-.06.45-.19.85-.34,1.22ZM29.01,289.98c1.37.31,1.7,2.48,0,0h0ZM45.97,320.37c-.25-.33-.49-.65-.74-.98l.34-.28c.25.32.49.65.74.97l-.34.29ZM59.68,68.61s-.01-.07-.02-.1h.12s-.07.07-.1.1ZM62.07,68.23l-.34-.29c.28-.3.56-.6.84-.89l.34.29c-.28.3-.56.59-.84.89ZM88.85,46.13c-.07,1.4-2.16,2.09,0,0h0ZM105.74,31.01c-1.12.59-.96-.42-2.07.2-.19-.42,1.92-.84,3.19-1.89.08.48-1.21,1.21-1.12,1.69ZM253.55,11.68c1.16.13,2.21.65,2.09,1.32-.45.01-.86-.04-1.26-.13-.4-.09-.78-.19-1.16-.31-.76-.23-1.5-.48-2.33-.48.26-.43,1.5-.55,2.66-.4ZM210.9,26.74c1.65.16,1.67-.39,2.1-.76.28.04.55.07.73.05.08,0,.42-.17.79-.35.07,0,.12,0,.2.01.72.4-.54.9-.98,1.53-.92-.04-1.84-.08-2.77-.11-.18-.1-.26-.23-.07-.38ZM242.78,268.82c0,3.37-4,5.26-9.68,5.26h-98.72c-1.69,0-3.79-.43-2.74-3.59l1.26-3.57c.85-2.32,2.53-2.53,4.01-2.95,5.26-1.05,10.73-4.43,10.73-12.42v-108.85c0-9.05-3.16-10.53-13.47-12.84-2.74-.42-3.16-2.11-2.32-3.79l1.69-4.21c.63-1.04,1.69-1.67,3.58-1.67h53.47c1.68,0,3.78.42,2.73,3.58l-1.27,3.57c-.83,2.31-2.52,2.52-3.99,2.94-5.26,1.05-10.74,4.43-10.74,12.42v98.96c0,17.68,3.79,21.68,15.36,21.68h17.05c20.63,0,23.58-19.57,26.52-18.73l5.26,1.69c.84.2,1.26,1.05,1.26,1.89v20.62ZM292.6,163.78c-9.6,15.61-10.37,21.65-9.32,23.97.36.78,1,1.27,1.91,1.43,1.13.18,2.24-.18,2.25-.18.2-.07.42.03.51.23.09.19.03.41-.14.54l-.19.12s-.08.09-.14.13c0,0-.13.08-.34.19-6.43,4.29-10.47,8.04-12,11.13-.85,2.07-.61,3.89.72,5.54,1.91,1.73,5.16,2.35,5.78,2.46.15.04.18.04.18.04.16.02.29.13.34.3.05.15,0,.33-.12.42-.4.38-10.04,8.81-19.85,8.5-.53-.01-1.04-.06-1.47-.13-.96-.1-1.98-.24-3.01-.41-7.72-1.32-15.45-4.4-19.91-6.66l-.17-.03c-.31,1.4-.71,2.78-1.25,4.13-1.28,3.23-3.25,6.24-5.75,8.75-2.5,2.52-5.5,4.49-8.67,5.95-2.25,1.03-4.89,1.92-7.42,2.59l.06-.06c-1.43.29-3.96-.12-2.78-2.51l1.52-3.12c.72-1.48.98-2.3,1.75-2.49.02,0,.03,0,.05,0,.46-.11,1-.16,1.72-.34,0,0,11.77-2.16,16.19-13.52-4.99.65-12.81.97-20.14-.28-1.03-.17-2.03-.38-2.98-.6-.42-.08-.91-.2-1.41-.36-9.36-2.94-16.08-14.14-16.36-14.63-.08-.14-.07-.31.01-.47.1-.13.27-.19.43-.16,0,0,.07.01.17.02.64.12,3.91.59,6.28-.41,1.79-1.12,2.61-2.75,2.5-5.02-.43-3.4-3.01-8.26-7.67-14.46-.14-.16-.23-.26-.23-.26-.05-.06-.08-.11-.1-.17l-.13-.18c-.13-.16-.1-.4.04-.56.14-.15.38-.17.56-.04,0,0,.95.71,2.06.91.92.15,1.69-.09,2.26-.71,1.76-1.85,3.03-7.81-.87-25.71-.05-.2.06-.4.25-.49.2-.08.42,0,.52.17.06.09,5.04,7.81,10.53,10.86.41.14.72.11.97-.05.6-.43.79-2.09.91-2.88.1-.7.14-.98.49-.99.33-.03.42.33.5.56.83,3.13,1.07,4.43,2.86,7.59,1.97,2.47,5.01,5.7,7.61,6.15.95.16,1.74-.06,2.42-.69,1.81-1.65,3.69-6.99,2.48-23.07-.02-.18.1-.36.27-.43.17-.07.38-.02.49.15.01.03,2.19,2.98,5.59,3.55,4.97.85,10.09-3.77,14.83-13.34.08-.17.26-.26.44-.24.18.04.33.18.35.38,1.31,10.6,4.62,16.65,9.59,17.48,3.39.58,6.42-1.49,6.45-1.51.15-.11.36-.09.51.03.14.11.19.32.12.49-6.47,14.78-6.43,20.45-5.29,22.59.44.83,1.12,1.29,2.06,1.45,2.51.42,6.23-1.45,8.89-3.1l-.1.05c2.97-2.55,3.58-3.66,5.47-6.42.14-.2.35-.5.65-.38.31.14.27.42.13,1.1-.15.79-.53,2.4-.1,3.01.17.24.43.37.84.38,6.24-.93,13.68-6.75,13.76-6.82.16-.13.39-.12.55.01.15.13.19.36.08.55ZM299.98,50.83c-.18-.12-.34-.24-.5-.36-.51-.65-1.19-1.31-2.04-1.98-.12-.1-.24-.19-.37-.29.53-.11,1.41.3,2.1.46.58.38,1.16.77,1.73,1.16.02.52-.23.97-.92,1ZM313.45,61.45c-.43-.36-.87-.72-1.3-1.09-.3-.27-.61-.53-.92-.79l-.1-.15.45-.17c-.52-.39-1.03-.73-1.49-1.06-.46-.34-.88-.66-1.26-.98-.77-.64-1.4-1.24-1.94-1.83.69.2,1.57.9,2.5,1.7.93.8,1.91,1.68,2.75,2.34l-.13.18.86.53.31.66c1.07.28,1.63,1.18,2.6,2.02-.47-.35-1.42-.86-2.34-1.35Z"/>
<path class="cls-2" d="M56.1,335.5c-.44-.32-.81-.5-.96-.15.15.37.49.83.9,1.3.42.45.93.89,1.38,1.23.91.68,1.63.97,1.2.1l-.88-.72-.28-.75c-.21-.11-.44-.29-.68-.47-.23-.19-.47-.39-.69-.55Z"/>
<path class="cls-2" d="M41.46,314.96l-1.28-1.34c.42.48.77.84,1.28,1.34Z"/>
<path class="cls-2" d="M19.32,281.74c-.11-.27-.23-.64-.36-1.01-.26-.74-.52-1.47-.52-1.47.34.98.57,1.97,1.06,2.94,0,0-.07-.18-.18-.45Z"/>
<path class="cls-2" d="M387.05,146.4c-.07-.22-.15-.43-.21-.59-.06-.16-.1-.27-.1-.27.27.56.42,1.15.61,1.73,0,0-.15-.44-.29-.87Z"/>
<path class="cls-2" d="M384.75,257.38c-.1-.53-.27-.79-.42-1.15l.42,1.15Z"/>
</svg>`

/* INSERT COMPONENT */
document.getElementById("video_component").innerHTML = `
<img
  class="iframe"
  src="https://firebasestorage.googleapis.com/v0/b/forum-8423f.appspot.com/o/livestream%2Fposter.jpg?alt=media&token=052dca3e-e347-47bb-90a2-d26588ac1adf"
/>
`;

document.getElementById("reaction_component").innerHTML = `
<p class="reaction_text">${t["reaction_text"][lang]}</p>
<div class="reactions">
  <div class="reaction" id="reactions_cheer">
          <div>
              <span class="reactions_count">
                  <span class="count" id="reactions_cheer_count"></span>
                  <span class="placeholder">-</span>
              </span>
          </div>
      <button name="cheer" class="reaction_button">🥳</button>
  </div>
  <div class="reaction" id="reactions_like">
      <div>
      <span class="reactions_count"
          ><span class="count" id="reactions_like_count"></span
          ><span class="placeholder">-</span></span
      >
      </div>
      <button name="like" class="reaction_button">👍</button>
  </div>
  <div class="reaction" id="reactions_love">
      <div>
      <span class="reactions_count"
          ><span class="count" id="reactions_love_count"></span
          ><span class="placeholder">-</span></span
      >
      </div>
      <button name="love" class="reaction_button">😍</button>
  </div>
</div>
`;

document.getElementById("bingo_component").innerHTML = `
<div id="bingo_export">
<div class="bingo-header">
<div>${t['bingo']['header'][lang]}</div><div>
<span style='width: 75%;
display: inline-block;
text-align: center;
border-bottom: 1px solid #fff;
line-height: 0.1em;
font-size: 0.5em;
font-weight: 300;
margin: 0.1em 0px 0.1em 0px;'><span style='background:#272727; 
padding:0 0.3em;'>2024</span></span></div>

</div>
<div class="bingo-sheet">
    <div class="bingo-section" data-section="1">
        <div class="active">${svg}</div>
      ${t['bingo']['s1'][lang]}</div>
    <div class="bingo-section" data-section="2">
          <div class="active">${svg}</div>
      ${t['bingo']['s2'][lang]}</div>
    <div class="bingo-section" data-section="3">
          <div class="active">${svg}</div>
      ${t['bingo']['s3'][lang]}</div>
    <div class="bingo-section" data-section="4">
          <div class="active">${svg}</div>
      ${t['bingo']['s4'][lang]}</div>
    <div class="bingo-section" data-section="5">
          <div class="active">${svg}</div>
      ${t['bingo']['s5'][lang]}<a href='${t['bingo']['link'][lang]}' target='_blank' style='color:#d71920; font-weight:700; text-decoration:none;'>${t['bingo']['link_text'][lang]}</a></div>
    <div class="bingo-section" data-section="6">
          <div class="active">${svg}</div>
      ${t['bingo']['s6'][lang]}</div>
    <div class="bingo-section" data-section="7">
          <div class="active">${svg}</div>
      ${t['bingo']['s7'][lang]}</div>
    <div class="bingo-section" data-section="8">
          <div class="active">${svg}</div>
      ${t['bingo']['s8'][lang]}</div>
    <div class="bingo-section" data-section="9">
          <div class="active">${svg}</div>
      ${t['bingo']['s9'][lang]}</div>
</div>
</div>
<div class="bingo-message" id="bingo-message">
  <h3>${t['bingo']['win'][lang]}</h3>
  <a id='share-sheet-button' class="share-button">${t['bingo']['share_button'][lang]}</a>
</div>
`;

/* EMOJI CLICK HANDLER */

let lastClickTime = 0;
const debounceInterval = 500;

document.querySelectorAll(".reaction_button").forEach((button) => {
  button.addEventListener("click", () => {
    const currentTime = Date.now();

    if (currentTime - lastClickTime < debounceInterval) {
      return; // Exit the function if clicked too quickly
    }

    lastClickTime = currentTime; // Update the last click time

    const reaction = button.name;
    userTriggeredUpdate = true; // Set the flag to indicate a user-triggered update
    createAndAnimateEmoji(reaction, true); // Now passing a flag to indicate user-triggered

    const reactionsRef = doc(
      db,
      "livestreams/mll2hccPnNBua9PWcE0x/reactions",
      "reactionsCounts"
    );
    updateDoc(reactionsRef, {
      [reaction]: increment(1),
    });
  });
});

function createAndAnimateEmoji(emojiType, isUserTriggered = false) {
  var emojiList = {
    like: "👍",
    love: "😍",
    cheer: "🥳",
  };

  var emoji = document.createElement("div");
  emoji.textContent = emojiList[emojiType]; // Random emoji
  emoji.style.position = "absolute";
  emoji.style.bottom = "0";
  emoji.style.left = `${Math.random() * 20}%`; // Random starting position
  emoji.style.fontSize = "24px";
  document.getElementById("video_component").appendChild(emoji);

  // customize emoji if user triggered
  if (isUserTriggered) {
    //add a "you" badge to the emoji
    var badge = document.createElement("div");
    badge.textContent = t["you"][lang];
    badge.style.position = "absolute";
    badge.style.bottom = "-20px";
    badge.style.left = "50%"; // Adjust to center horizontally
    badge.style.transform = "translateX(-50%)"; // Center relative to its own width
    badge.style.fontSize = "12px";
    badge.style.color = "white";
    badge.style.backgroundColor = "red";
    badge.style.padding = "2px 4px";
    badge.style.borderRadius = "4px";
    badge.style.fontFamily = "Poppins";
    badge.style.textAlign = "center";
    emoji.appendChild(badge);
  }

  var duration = 3000 + Math.random() * 2000; // Random duration between 3 and 5 seconds

  var startTime = null;

  function animate(time) {
    if (!startTime) startTime = time;
    var timeElapsed = time - startTime;
    // Normalized timeElapsed to range from 0 to 1
    var normalizedTimeElapsed = timeElapsed / duration;

    // Custom easing: faster in the first 30%, then normal speed
    var progress;
    if (normalizedTimeElapsed < 0.3) {
      // Accelerate progress in the first 30%
      // Adjust the multiplier to control the acceleration
      progress = normalizedTimeElapsed * 2; // Example: make it move faster
    } else {
      // After 30%, continue at normal pace, adjusting for the initial boost
      // The magic number 0.6 balances out the accelerated part to ensure smooth transition
      progress = 0.6 + (normalizedTimeElapsed - 0.3);
    }

    if (progress < 1) {
      emoji.style.bottom = `${progress * 100}%`; // Move emoji up
      requestAnimationFrame(animate);
    } else {
      emoji.remove(); // Remove emoji after it reaches the top
    }
  }

  requestAnimationFrame(animate);
}

/* EMOJI COUNT ANIMATION HANDLER */

function triggerContentChangedEvent(buttonId) {
  const event = new CustomEvent("contentchanged");
  document.getElementById(buttonId).dispatchEvent(event);
}

// Function to add the animation class and remove it after the animation ends
function animateButton(button) {
  button.classList.add("button-animate");
  button.addEventListener("animationend", () => {
    button.classList.remove("button-animate");
  });
}

/* BINGO SHEET */

const winningCombinations = [
  ["1", "2", "3"], // First row
  ["4", "5", "6"], // Second row
  ["7", "8", "9"], // Third row
  ["1", "4", "7"], // First column
  ["2", "5", "8"], // Second column
  ["3", "6", "9"], // Third column
  ["1", "5", "9"], // Diagonal from top-left to bottom-right
  ["3", "5", "7"], // Diagonal from top-right to bottom-left
];

document.addEventListener("DOMContentLoaded", () => {
  const sections = document.querySelectorAll(".bingo-section");
  const bingoMessage = document.getElementById("bingo-message");

  sections.forEach((section) => {
    section.addEventListener("click", () => {
      section.querySelector(".active").classList.toggle("show");
      checkForBingo();
    });
  });

  function checkForBingo() {
    for (let combination of winningCombinations) {
      const hasBingo = combination.every((sectionId) => {
        return document
          .querySelector(`[data-section="${sectionId}"]`)
          .querySelector(".active")
          .classList.contains("show");
      });

      if (hasBingo) {
        bingoMessage.style.display = "flex"; // Show "BINGO!" message
        break; // Stop checking after finding a Bingo
      } else {
        bingoMessage.style.display = "none";
      }
    }
  }
});

document.getElementById("share-sheet-button").addEventListener("click", () => {
  html2canvas(document.getElementById("bingo_export"), { useCORS: true }).then(function (canvas) {
    //download the image
    if (
      navigator.canShare &&
      (navigator.userAgent.match(/Android/i) ||
        navigator.userAgent.match(/webOS/i) ||
        navigator.userAgent.match(/iPhone/i) ||
        navigator.userAgent.match(/iPad/i) ||
        navigator.userAgent.match(/iPod/i) ||
        navigator.userAgent.match(/BlackBerry/i))
    ) {
      var blob = new Blob([canvas.toDataURL()], { type: "image/png" });
      var file = new File([blob], "bingo.png", { type: "image/png" });

      navigator.share({
        files: [file],
        text: "Check out my #BudgetBingo sheet!",
      });
    } else {
      var link = document.createElement("a");
      link.download = "bingo.png";
      link.href = canvas.toDataURL();
      link.click();
    }
  });
});
